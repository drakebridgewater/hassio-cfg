template:
  # - sensor:
  #       name: Grid Import Power
  #       state_class: measurement
  #       icon: mdi:transmission-tower
  #       unit_of_measurement: "W"
  #       device_class: power
  #       state: >
  #           {{ [0, states('sensor.envoy_12201xxxxxxx_current_energy_consumption') | int(default=0) - states('sensor.envoy_202208027163_current_power_production') | int(default=0) ] | max }}
  # - sensor:
  #       name: Grid Export Power
  #       state_class: measurement
  #       icon: mdi:transmission-tower
  #       unit_of_measurement: "W"
  #       device_class: power
  #       state: >
  #           {{ [0, states('sensor.envoy_202208027163_current_power_production') | int(default=0) - states('sensor.envoy_12201xxxxxxx_current_energy_consumption') | int(default=0) ] | max }}

  - sensor:
        name: Solar Power Corrected
        state_class: measurement
        icon: mdi:solar-panel
        unit_of_measurement: "kW"
        device_class: power
        state: >
            {% set value = (states('sensor.envoy_202208027163_current_power_production') | float(default=0) /1000) | round(2)  %}
            {% if is_state('sensor.enphase_status', "Sleep")%}0{%else%}{{ value}}{%endif%}